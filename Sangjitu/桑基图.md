[桑基图.xlsx](https://xingjian.yuque.com/attachments/yuque/0/2023/xlsx/34485719/1698636515157-272cc626-1212-4c82-b385-00c703e434b9.xlsx)

# 1.基本函数

## 1.index()

![20210507094135282.png](https://cdn.nlark.com/yuque/0/2023/png/34485719/1698389260858-818a2e5e-d26a-4ee9-b1ea-4067d60fdf51.png#averageHue=%23fdfdfd&clientId=u533a58b3-754c-4&from=drop&id=u7f5d9b7e&originHeight=108&originWidth=358&originalType=binary&ratio=1&rotation=0&showTitle=false&size=4979&status=done&style=none&taskId=ub3e8f00a-2ad0-4a86-818a-979b61c772a&title=)![20210507094734414.png](https://cdn.nlark.com/yuque/0/2023/png/34485719/1698389263223-8f59b642-6014-4b6d-8a37-cada3d668322.png#averageHue=%23faf7f7&clientId=u533a58b3-754c-4&from=drop&id=u19bee59d&originHeight=461&originWidth=676&originalType=binary&ratio=1&rotation=0&showTitle=false&size=47704&status=done&style=none&taskId=u6aef294c-6664-4209-8050-bd362d32459&title=)
## 2.running_sum(),running_avg()
取running_avg举例
![20210507101427809.png](https://cdn.nlark.com/yuque/0/2023/png/34485719/1698389319747-e96c4c7f-e247-406e-8cfb-2aad7650f2c6.png#averageHue=%23fdfcfb&clientId=u533a58b3-754c-4&from=drop&id=u0965ee93&originHeight=95&originWidth=391&originalType=binary&ratio=1&rotation=0&showTitle=false&size=7130&status=done&style=none&taskId=u204a740a-7a78-49a1-90e8-b4006b13d21&title=)![20210507101626479.png](https://cdn.nlark.com/yuque/0/2023/png/34485719/1698389342151-c95c6fe6-75c0-46bc-8db4-2e4a63239e0d.png#averageHue=%23f9f8f8&clientId=u533a58b3-754c-4&from=drop&id=m8WR7&originHeight=459&originWidth=539&originalType=binary&ratio=1&rotation=0&showTitle=false&size=44496&status=done&style=none&taskId=u3691e1ac-5167-4826-8a28-00595563a27&title=)
![image.png](https://cdn.nlark.com/yuque/0/2023/png/34485719/1698389365343-eeda57a5-68df-4d86-b38c-73adacb4d3e0.png#averageHue=%23fbfbfa&clientId=u533a58b3-754c-4&from=paste&height=141&id=u53d59ab3&originHeight=141&originWidth=312&originalType=binary&ratio=1&rotation=0&showTitle=false&size=8734&status=done&style=none&taskId=ud1dfae0f-e503-460f-a582-cc6d4ff7fe1&title=&width=312)
> running_sum: 返回从第一行累计的相加到当前行的值

## 3.total()
函数公式为TOTAL(expression)，表示返回给定表达式（expression）的总计。例如，TOTAL(SUM([营销额]))，用于计算各自分区中全部行的SUM(营销额)
# 2.Sigmoid曲线
画Sigmoid曲线需要用到【线】标记下的【路径】选项。将某一个字段拖拽到【路径】中，相当于将原本汇总的数据按字段进行分组，然后将新形成的点串联成线。 举个例子，先定义两个计算字段【index】和【fun】，其中【index】的定义与前文相同，【fun】的定义如下：
![20210510141452920.png](https://cdn.nlark.com/yuque/0/2023/png/34485719/1698389856270-ff8e0af5-6d2a-4588-a48c-ef94aa8d4120.png#averageHue=%23faf8f7&clientId=u533a58b3-754c-4&from=drop&id=u20469223&originHeight=200&originWidth=492&originalType=binary&ratio=1&rotation=0&showTitle=false&size=8830&status=done&style=none&taskId=ud5ba2c1b-c46a-4b9d-b6f2-e1fb6697f0e&title=)
将【index】和【fun】分别拖到【列】和【行】中，此时表中只有一个点(因为INDEX()是聚合函数)。如下图：![20210510141848198.png](https://cdn.nlark.com/yuque/0/2023/png/34485719/1698542592474-95b700ac-6a2c-4f94-a9fc-53d69967a816.png#averageHue=%23fcfbfb&clientId=ud87ff380-60be-4&from=drop&id=u3188711c&originHeight=640&originWidth=1190&originalType=binary&ratio=1&rotation=0&showTitle=false&size=49020&status=done&style=none&taskId=u84517bf9-452f-4efe-a23e-448b2aec150&title=)
接下来，将【标记】中的【自动】改为【线】，并将【维度】中的【子类别】拖到【路径】选项中，编辑【index】和【fun】的计算依据，将其【计算依据】都改为【特定维度】下的【子类别】。将【列】中的【index】复制到【标签】选项中，得到如下结果：
![20210510142729529.png](https://cdn.nlark.com/yuque/0/2023/png/34485719/1698542612070-f2149f58-44a0-46fa-8bbd-4ee1ecf63171.png#averageHue=%23fbfafa&clientId=ud87ff380-60be-4&from=drop&id=ub96f0c3c&originHeight=937&originWidth=1144&originalType=binary&ratio=1&rotation=0&showTitle=false&size=102003&status=done&style=none&taskId=uc29d660a-849a-4886-9eab-f9ed0ef0881&title=)上图中的线将索引号从1到17的点连接了起来得到了一条抛物曲线。下面来画sigmoid曲线。修改【index】和【fun】的定义，具体如下：
![20210510143601626.png](https://cdn.nlark.com/yuque/0/2023/png/34485719/1698542636983-5fa3032f-2051-444c-b80a-4c34298abc1c.png#averageHue=%23f8f8f8&clientId=ud87ff380-60be-4&from=drop&id=ucee923b6&originHeight=130&originWidth=275&originalType=binary&ratio=1&rotation=0&showTitle=false&size=14236&status=done&style=none&taskId=u417dd6d8-9386-4fce-89ff-56ad590ca67&title=)![2021051014350130.png](https://cdn.nlark.com/yuque/0/2023/png/34485719/1698542638915-7a300af9-d9da-41d4-9dd4-24e55d54a56c.png#averageHue=%23faf9f9&clientId=ud87ff380-60be-4&from=drop&id=ud7f00ec4&originHeight=140&originWidth=322&originalType=binary&ratio=1&rotation=0&showTitle=false&size=7248&status=done&style=none&taskId=u810b1886-2a71-4e3d-aee2-264325ede47&title=)

重复刚才画抛物线的步骤，即可得到下图，sigmoid曲线就完成了。![20210510144027807.png](https://cdn.nlark.com/yuque/0/2023/png/34485719/1698542660991-28b796d3-f541-43b8-9680-fcc626cb3ed7.png#averageHue=%23fbfbfb&clientId=ud87ff380-60be-4&from=drop&id=u54009b0c&originHeight=527&originWidth=596&originalType=binary&ratio=1&rotation=0&showTitle=false&size=40104&status=done&style=none&taskId=u28cb1d7d-c14b-48cf-9aa1-5e2ecb66123&title=)
# 3.画桑基图
## 1.数据：
![image.png](https://cdn.nlark.com/yuque/0/2023/png/34485719/1698632737678-a48b7087-6328-4462-8f22-ad3021b7799c.png#averageHue=%23f6f4f3&clientId=ufec467c8-9d62-4&from=paste&height=260&id=u4d65a6b4&originHeight=260&originWidth=507&originalType=binary&ratio=1&rotation=0&showTitle=false&size=24653&status=done&style=none&taskId=uc2a6c50f-3520-4cb4-9acf-d5231328b26&title=&width=507)
添加一列（列名随意）：
![image.png](https://cdn.nlark.com/yuque/0/2023/png/34485719/1698633024409-35b64052-533c-4248-8ff7-e1dba9ad86a0.png#averageHue=%23f6f3f2&clientId=u5c0ce178-54a3-4&from=paste&height=329&id=LlJI4&originHeight=329&originWidth=667&originalType=binary&ratio=1&rotation=0&showTitle=false&size=36124&status=done&style=none&taskId=udf6e114f-2057-4b0a-8ab1-94b9e00abbb&title=&width=667)
创建新表：
![image.png](https://cdn.nlark.com/yuque/0/2023/png/34485719/1698633104279-eac74efc-9ab3-425c-bceb-90a00a9a198b.png#averageHue=%23f7f6f6&clientId=u5c0ce178-54a3-4&from=paste&height=508&id=u20b4eba5&originHeight=508&originWidth=316&originalType=binary&ratio=1&rotation=0&showTitle=false&size=14675&status=done&style=none&taskId=u1f2e0b5f-294e-4833-8688-db00002c1c3&title=&width=316)
## 2.tableau连接表：
![image.png](https://cdn.nlark.com/yuque/0/2023/png/34485719/1698633191215-517c3dfe-0a9a-4ddb-92f4-53e273399142.png#averageHue=%23f8f6f6&clientId=u5c0ce178-54a3-4&from=paste&height=982&id=ub034b1cc&originHeight=982&originWidth=941&originalType=binary&ratio=1&rotation=0&showTitle=false&size=102618&status=done&style=none&taskId=u7edbddf3-cf97-4e7e-8ee6-7434218bdd5&title=&width=941)
创建字段：

| 名称 | 定义 | 作用 |
| --- | --- | --- |
| index | (index()-25)/5 | 将index的计算依据改为【类型（数据）】之后，可以保证index取值范围在【-4.8, 4.8】之间 |
| sigmoid | 1/(1+EXP(-[index])) | sigmoid曲线 |
| rank1 | RUNNING_AVG(SUM([销售额]))/TOTAL(SUM([销售额])) | sigmoid曲线的左起点高度 |
| rank2 | RUNNING_AVG(SUM([销售额]))/TOTAL(SUM([销售额])) | sigmoid曲线的右终点高度 |
| ft | [rank1]+([rank2]-[rank1])*[sigmoid] | sigmoid曲线函数 |
| size | RUNNING_AVG(SUM([销售额])) | 调整sigmoid曲线粗细，占比越大曲线越粗 |

添加数据桶：
![image.png](https://cdn.nlark.com/yuque/0/2023/png/34485719/1698634413550-99571786-7f30-49c1-a9f6-46ebeca17de2.png#averageHue=%23f0efef&clientId=u5c0ce178-54a3-4&from=paste&height=444&id=u1f642558&originHeight=444&originWidth=354&originalType=binary&ratio=1&rotation=0&showTitle=false&size=24543&status=done&style=none&taskId=ua823615c-c4d7-4829-8dc9-14031a435ea&title=&width=354)
![image.png](https://cdn.nlark.com/yuque/0/2023/png/34485719/1698634429858-ee319457-2cd9-4bb1-b6b1-2639215f9170.png#averageHue=%23ebeae9&clientId=u5c0ce178-54a3-4&from=paste&height=224&id=ufc8d9a0c&originHeight=224&originWidth=436&originalType=binary&ratio=1&rotation=0&showTitle=false&size=14515&status=done&style=none&taskId=u43bf6755-2139-4212-a995-dda28b663a2&title=&width=436)
![image.png](https://cdn.nlark.com/yuque/0/2023/png/34485719/1698634708206-7dc3f6ed-5c02-488d-a72e-9a5dafc8b988.png#averageHue=%23f3f3f2&clientId=u5c0ce178-54a3-4&from=paste&height=456&id=ud478ca3a&originHeight=456&originWidth=398&originalType=binary&ratio=1&rotation=0&showTitle=false&size=22608&status=done&style=none&taskId=u040a2154-e77d-4779-bb63-2326717e958&title=&width=398)
## 3.画sigmoid图：
![image.png](https://cdn.nlark.com/yuque/0/2023/png/34485719/1698634508432-8162fa87-645a-44db-9b2f-f20722f78882.png#averageHue=%23f9f7f6&clientId=u5c0ce178-54a3-4&from=paste&height=873&id=udbcf1251&originHeight=873&originWidth=728&originalType=binary&ratio=1&rotation=0&showTitle=false&size=83703&status=done&style=none&taskId=u7548e84b-338a-4132-ac53-2b111fede49&title=&width=728)
编辑表计算：
![image.png](https://cdn.nlark.com/yuque/0/2023/png/34485719/1698634558244-cbd64f77-bede-4e30-a8d8-5ed9b09f76aa.png#averageHue=%23f8f5f4&clientId=u5c0ce178-54a3-4&from=paste&height=521&id=u982a9f36&originHeight=521&originWidth=329&originalType=binary&ratio=1&rotation=0&showTitle=false&size=24648&status=done&style=none&taskId=ueacdd6b9-cd55-4999-82fc-1ca6fbdf3ac&title=&width=329)![image.png](https://cdn.nlark.com/yuque/0/2023/png/34485719/1698634575092-449f46dd-44b7-45b0-8bed-25b10151cc05.png#averageHue=%23f8f5f4&clientId=u5c0ce178-54a3-4&from=paste&height=521&id=u8d480414&originHeight=521&originWidth=329&originalType=binary&ratio=1&rotation=0&showTitle=false&size=24122&status=done&style=none&taskId=u8bdd3039-8125-4d2a-9376-7e55ac39a18&title=&width=329)
![image.png](https://cdn.nlark.com/yuque/0/2023/png/34485719/1698634596915-497505d2-215f-4d35-a72f-924d625ed0e1.png#averageHue=%23f9f5f5&clientId=u5c0ce178-54a3-4&from=paste&height=493&id=u0ded5c67&originHeight=493&originWidth=329&originalType=binary&ratio=1&rotation=0&showTitle=false&size=21383&status=done&style=none&taskId=uab6bdde6-2118-4be5-913c-9f2e7d4a046&title=&width=329)![image.png](https://cdn.nlark.com/yuque/0/2023/png/34485719/1698634626505-2ce91ddf-c425-4882-910e-56490fa894f6.png#averageHue=%23f9f4f4&clientId=u5c0ce178-54a3-4&from=paste&height=438&id=u010b129a&originHeight=438&originWidth=329&originalType=binary&ratio=1&rotation=0&showTitle=false&size=20710&status=done&style=none&taskId=ud18c433c-201a-47a5-951d-6fd620e6fde&title=&width=329)
![image.png](https://cdn.nlark.com/yuque/0/2023/png/34485719/1698635664289-56a760f3-30e1-461c-a057-4767cd9fb484.png#averageHue=%23f8f4f3&clientId=u5c0ce178-54a3-4&from=paste&height=438&id=ucd68455c&originHeight=438&originWidth=329&originalType=binary&ratio=1&rotation=0&showTitle=false&size=22158&status=done&style=none&taskId=u4dc1db16-de20-4174-b76b-b04d878187d&title=&width=329)
## 4.画柱状图
![image.png](https://cdn.nlark.com/yuque/0/2023/png/34485719/1698635806060-5acbf70a-ce16-4338-9fff-91894c5dfa7d.png#averageHue=%23f8f1ed&clientId=u5c0ce178-54a3-4&from=paste&height=737&id=u7c065a0b&originHeight=899&originWidth=444&originalType=binary&ratio=1&rotation=0&showTitle=false&size=42790&status=done&style=none&taskId=ua8218448-99e8-412d-8fd2-dc021e4ed2f&title=&width=364)![image.png](https://cdn.nlark.com/yuque/0/2023/png/34485719/1698635824539-4fbc0c07-4a18-4837-a108-47e0dd23319e.png#averageHue=%23f9f4f2&clientId=u5c0ce178-54a3-4&from=paste&height=722&id=u9c48a9a8&originHeight=893&originWidth=449&originalType=binary&ratio=1&rotation=0&showTitle=false&size=43048&status=done&style=none&taskId=uf469525b-e860-4703-a33c-29934483ffd&title=&width=363)
## 5.整合
新建仪表板：
![image.png](https://cdn.nlark.com/yuque/0/2023/png/34485719/1698635986694-251a13ac-7f45-4c6c-bb7b-5c08c001c46d.png#averageHue=%23f9f0ed&clientId=u5c0ce178-54a3-4&from=paste&height=1014&id=u790bed36&originHeight=1014&originWidth=1231&originalType=binary&ratio=1&rotation=0&showTitle=false&size=136031&status=done&style=none&taskId=u615359dc-9b02-40ca-8869-8570ea936fb&title=&width=1231)
> 选择平铺并隐藏全部标题，然后选择浮动将两个柱状图加入

![image.png](https://cdn.nlark.com/yuque/0/2023/png/34485719/1698636095836-f7aa7f72-954d-41b3-b0e4-51657a59fa5f.png#averageHue=%23fbeee9&clientId=u5c0ce178-54a3-4&from=paste&height=845&id=u058327ce&originHeight=845&originWidth=998&originalType=binary&ratio=1&rotation=0&showTitle=false&size=91183&status=done&style=none&taskId=u8a858a22-a9bd-4996-8ee0-9bbad6c05e8&title=&width=998)
发现有些对不齐，倒序一下即可
![image.png](https://cdn.nlark.com/yuque/0/2023/png/34485719/1698636140622-aa8977f5-3d0d-4bd0-a83b-199aba623d25.png#averageHue=%23f9f3f1&clientId=u5c0ce178-54a3-4&from=paste&height=1040&id=uff579129&originHeight=1040&originWidth=1920&originalType=binary&ratio=1&rotation=0&showTitle=false&size=210313&status=done&style=none&taskId=u5533e08c-bb00-44fe-a430-691ce2c09bf&title=&width=1920)
![image.png](https://cdn.nlark.com/yuque/0/2023/png/34485719/1698636481589-0352f37d-0305-48b1-9aed-733d0a0d398d.png#averageHue=%23f8efeb&clientId=u5c0ce178-54a3-4&from=paste&height=981&id=ua4ab85f7&originHeight=981&originWidth=1285&originalType=binary&ratio=1&rotation=0&showTitle=false&size=125611&status=done&style=none&taskId=u513da262-ffe2-4f88-b381-25a014cb603&title=&width=1285)
